# 智能拐杖小程序使用说明

本项目是一个微信小程序，用于连接 ESP32 蓝牙模块，实现跌倒检测、本地播报及亲属远程监控功能。

## 1. 目录结构

```
smart-cane-miniprogram/
  ├── app.js            # 全局逻辑，初始化云开发
  ├── app.json          # 全局配置
  ├── app.wxss          # 全局样式
  ├── pages/
  │   ├── index/        # 首页（身份选择）
  │   ├── elder/        # 老人端（蓝牙连接与检测）
  │   └── family/       # 亲属端（远程查看状态）
```

## 2. 快速开始

1.  **导入项目**：
    *   打开微信开发者工具。
    *   选择“导入项目”，目录选择本文件夹 `smart-cane-miniprogram`。
    *   AppID 请使用你自己的小程序 AppID（测试号也可以，但云开发功能受限）。

2.  **开通云开发**（关键步骤）：
    *   在开发者工具工具栏点击“云开发”按钮。
    *   按照提示开通云开发环境（免费版即可）。
    *   获取环境 ID，填入 `app.js` 中的 `env: 'your-env-id'` 处。
    *   **创建数据库集合**：
        *   进入云开发控制台 -> 数据库。
        *   点击“+”号，创建一个新的集合，名称必须为 `cane_status`。
        *   将该集合的权限设置为“所有用户可读，仅创建者可读写”或“所有用户可读写”（为了测试方便，建议先设为所有用户可读写）。

3.  **修改蓝牙配置**：
    *   打开 `pages/elder/elder.js`。
    *   找到 `startScan` 函数中的过滤逻辑。
    *   确保你的 ESP32 蓝牙广播名称包含 "ESP32" 或 "Cane"，或者修改代码中的过滤条件以匹配你的设备名称。
    *   如果你的 ESP32 使用了特定的服务 UUID，建议在 `getServices` 函数中进行精确匹配。

## 3. 功能说明

### 老人端
*   点击“搜索并连接拐杖”，小程序会自动搜索附近的蓝牙设备。
*   连接成功后，界面显示“状态正常”。
*   当 ESP32 发送数据（模拟跌倒信号）时，界面变红，显示“跌倒报警”，手机震动，并自动将状态同步到云数据库。
*   点击“解除警报”可恢复正常状态。

### 亲属端
*   点击“刷新状态”可从云数据库拉取最新的拐杖状态。
*   如果老人端触发了跌倒报警，亲属端刷新后会看到红色的报警提示。

## 4. ESP32 端配合

ESP32 端需要编写蓝牙 BLE 代码，要求如下：
1.  广播名称建议包含 "ESP32" 或 "Cane"。
2.  开启一个 Notify 特征值。
3.  当检测到跌倒时，通过该特征值发送数据（任意非空数据即可触发本小程序的报警逻辑）。

## 5. 注意事项

*   **真机调试**：蓝牙功能只能在真机上测试，模拟器无法连接蓝牙。
*   **权限**：Android 手机使用蓝牙功能通常需要开启位置权限和蓝牙开关。
